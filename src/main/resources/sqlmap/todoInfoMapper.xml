<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="to_doMapper">

 <resultMap type="com.todo.api.to_do.service.TodoVO" id="todoInfoMap">
	<result property="seqSN" column="SEQ_SN"/>
	<result property="userId" column="USER_ID"/>
	<result property="todoUnit" column="TODO_UNIT"/>
	<result property="todoTitle" column="TODO_TITLE"/>
	<result property="todoContent" column="TODO_CONTENT"/>
	<result property="todoBegin" column="TODO_BEGIN"/>
	<result property="todoEnd" column="TODO_END"/>
	<result property="todoSucessAt" column="TODO_SUCESS_AT"/>
	<result property="todoChangeDt" column="TODO_CHANGE_DT"/>
	<result property="registDate" 	column="REGIST_DATE"/>
</resultMap>

	<select id="to_doMapper.todoTypeSelectList" resultMap="todoInfoMap" parameterType="map">
		WITH TODO_USER AS (
			SELECT 	USER_ID
			FROM 	USER 
			WHERE USER_ID = #{userId}
				UNION ALL
			SELECT FRIEND_ID
			FROM USER_FRIEND
			WHERE 	USER_ID = #{userId}
				AND FRIEND_SHOW_AT = 'Y'
		)
		SELECT B.*
		FROM TODO_USER A
			INNER JOIN TO_DO B
				ON A.USER_ID = B.REGIST_USER_ID
		WHERE B.TODO_UNIT = #{todoUnit}	
	</select>
	
	<insert id="to_doMapper.to_dosInsert" parameterType="todoVO" >
		INSERT INTO TODO(
						TODO_UNIT,
						TODO_TITLE,
						TODO_CONTENT,
						TODO_BEGIN,
						TODO_END,
						TODO_SUCESS_AT,
						REGIST_USER_ID,
						REGIST_DATE
					)
		VALUES(
				#{todoUnit},
				#{todoTitle},
				#{todoContent},
				STR_TO_DATE(#{todoBegin},'%Y%m%d%H%i'),
				STR_TO_DATE(#{todoEnd},'%Y%m%d%H%i'),
				'N',
				#{userId},
				SYSDATE()
		);
	</insert>
	
	<select id="to_doMapper.to_doInfoSelect" parameterType="todoVO" resultMap="todoInfoMap">
		SELECT	TODO_UNIT,
				TODO_TITLE,
				TODO_CONTENT,
				TODO_BEGIN,
				TODO_END,
				CASE WHEN TODO_SUCESS_AT = 'Y' THEN '완료'
					ELSE '진행중'
					END AS TODO_SUCESS_AT,
				REGIST_USER_ID AS USER_ID,
				REGIST_DATE
		FROM TO_DO
		WHERE SEQ_SN = #{seqSN}			
	</select>
	
	<delete id="to_doMapper.to_doDelete" parameterType="todoVO">
		DELETE
		FROM TO_DO
		WHERE SEQ_SN=#{seqSN}
	</delete>
	
	<update id="todo"></update>
	

</mapper>